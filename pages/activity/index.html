<div class="activity" v-if="isShowEmpty">
  <div class="empty">
    <van-empty image="https://p3.ssl.qhimg.com/d/inn/bf8a6ce0c558/placeholder-activity-detail.png">
      <p class="description">活动不存在或下线</p>
      <!-- <div class="bottom-button" @click="handleGoToHomePage">返回首页</div> -->
    </van-empty>
  </div>
</div>

<div class="activity" v-else>
  <div class="banner-container">
    <van-skeleton
      row="1"
      row-width="['100%']"
      :loading="!Object.keys(activityDetail).length"
    >
      <banner :list="imageList" />
    </van-skeleton>
  </div>

  <div class="basic">
    <van-skeleton
      title
      :row="2"
      :loading="!Object.keys(activityDetail).length"
    >

      <div class="info">
        <p class="title text-overflow-ellipsis">
          {{ activityDetail.name }}
        </p>

        <p class="time-remaining">
          <span>{{ currentActivityState.detailTimeName }}：</span>
          <b>{{ activityDetail.due_time }}</b>
        </p>

        <p class="number">
          <span class="recruit-number">招募人数：{{ activityDetail.recruit }}</span>
          <span class="split">｜</span>
          <span class="signed-up-number">已报名：{{ activityDetail.reg_count }}</span>
        </p>
      </div>

      <van-button
        class="follow-button"
        :loading="followLoading"
        loading-text="更改中..."
        @click="handleUpdateFollowStatus"
      >
        <div
          class="flex-center"
          :class="{ followed: activityDetail.attention_status === 2 }"
        >
          <span class="heart"></span>
          {{ activityDetail.attention_status === 2 ? '已经关注' : '关注活动' }}
        </div>
      </van-button>
    </van-skeleton>
  </div>

  <div
    class="report block"
    v-if="
      Object.keys(activityDetail).length &&
      activityDetail.status === 6
    "
  >
    <van-skeleton
      title
      :row="2"
      :loading="!isShowReport"
    >
      <p class="primary-title">测评报告</p>

      <van-icon
        class="more"
        v-if="reportList.length"
        name="arrow"
        color="#B5B5B5"
        @click="handleGoToReportList"
      />

      <template v-if="reportList.length">
        <van-swipe
          class="report-swipe"
          :autoplay="4000"
          :show-indicators="false"
          :touchable="false"
          vertical
        >
          <van-swipe-item
            class="report-swipe-item"
            v-for="(item, index) in reportList"
            :key="reportList.id"
            @click="handleGoToReportDetail(item.id)"
          >
            <img class="avatar" :src="item.avatar_url || defaultAvatar" />

            <p class="content text-overflow-line2">
              <!-- 若内容全为图片, 则显示标题 -->
              {{
                filterAllSpace(filterAllTag(item.content_modify || item.content || '...')) ?
                filterAllSpace(filterAllTag(item.content_modify || item.content || '...')) :
                (item.name_modify ? item.name_modify : item.name)
              }}
            </p>
          </van-swipe-item>
        </van-swipe>
      </template>

      <template v-else>
        <p class="empty-text">报告待公布</p>
      </template>
    </van-skeleton>
  </div>

  <div class="steps block">
    <van-skeleton
      title
      :row="1"
      row-width="95%"
      :loading="!Object.keys(activityDetail).length"
    >

      <p class="primary-title">活动流程</p>

      <ul class="list">
        <li class="item">
          <span>1</span>
          活动报名
        </li>

        <li class="item">
          <span>2</span>
          报名筛选
        </li>

        <li class="item">
          <span>3</span>
          产品内测
        </li>

        <li class="item">
          <span>4</span>
          活动奖励
        </li>
      </ul>

    </van-skeleton>
  </div>

  <div class="rules block">
    <van-skeleton
      title
      :row="10"
      :loading="!Object.keys(activityDetail).length"
    >
      <p class="primary-title">活动规则</p>

      <div
        class="content"
        v-html="activityDetail.content"
        @click="handlePreviewImage"
      >
      </div>
    </van-skeleton>
  </div>

  <div
    class="signed-up block"
    v-if="
      Object.keys(activityDetail).length &&
      [3, 4, 5, 6].includes(activityDetail.status)
    "
  >
    <van-skeleton
      title
      :row="2"
      :loading="!Object.keys(activityDetail).length && !signedUpUserListLoading"
    >
      <p class="primary-title">已报名</p>

      <template v-if="signedUpUserList.length">
        <ul class="list">
          <li
            class="item"
            v-for="(item, index) in signedUpUserList.slice(0, 6)"
            :key="index"
            @click="handleGoToPersonalHomePage(item.uid)"
          >
            <img class="avatar" :src="item.avatar_url || defaultAvatar" />
          </li>
        </ul>

        <p class="number" v-if="signedUpUserList.length > 6">
          等{{ activityDetail.reg_count }}人
        </p>
      </template>

      <template v-else>
        <p class="empty-text">名单待公布</p>
      </template>
    </van-skeleton>
  </div>

  <!-- <div
    class="filter-passed block"
    v-if="
      Object.keys(activityDetail).length &&
      [4, 5, 6].includes(activityDetail.status)
    "
  >
    <van-skeleton
      title
      :row="2"
      :loading="!Object.keys(activityDetail).length"
    >
      <p class="primary-title">筛选通过</p>

      <ul class="list clearfix">
        <li class="item pull-left" v-for="(item, index) in filterPassedUserList" :key="index">
          <img class="avatar" :src="item.image || defaultAvatar" />
        </li>

        <van-button
          v-if="filterPassedUserListHasMore"
          class="load-more"
          :loading="filterPassedUserListLoading"
          loading-text="加载中..."
          @click="getList"
        >
          <div class="flex-center">
            点击加载
            <div class="triangle-down"></div>
          </div>
        </van-button>

      </ul>
    </van-skeleton>
  </div> -->

  <!-- 筛选通过 start -->
  <div
    class="filter-passed block"
    v-if="
      Object.keys(activityDetail).length &&
      [4, 5, 6].includes(activityDetail.status)
    "
  >
    <van-skeleton
      title
      :row="2"
      :loading="!Object.keys(activityDetail).length && !filterPassedUserListLoading"
    >
      <p class="primary-title">筛选通过</p>

      <template v-if="filterPassedUserList.length">
        <ul class="list clearfix">
          <li
            class="item pull-left"
            v-for="(item, index) in filterPassedUserList"
            :key="index"
            @click="handleGoToPersonalHomePage(item.uid)"
          >
            <img class="avatar" :src="item.avatar_url || defaultAvatar" />
          </li>

          <van-button
            v-if="filterPassedUserListHasMore"
            class="load-more"
            :loading="filterPassedUserListLoading"
            loading-text="加载中..."
            @click="getActivityFilterPassedUserList"
          >
            <div class="flex-center">
              点击加载
              <div class="triangle-down"></div>
            </div>
          </van-button>

        </ul>
      </template>

      <template v-else>
        <p class="empty-text">名单待公布</p>
      </template>
    </van-skeleton>
  </div>
  <!-- 筛选通过 end -->

  <!-- <div class="contribution-list block" v-if="[4, 5, 6].includes(activityDetail.status)">
    <van-skeleton
      title
      :row="6"
      :loading="!Object.keys(activityDetail).length"
    >
      <p class="primary-title">产品体验贡献榜</p>

      <ul class="list clearfix">
        <li class="item pull-left" v-for="(item, index) in 16" :key="index">
          <span>
            <img class="avatar" src="https://avatars.githubusercontent.com/u/35414619?s=88&u=a88114e67bf3c874c64ad0cb976526182972f614&v=4" />
          </span>
          <p>12</p>
        </li>
      </ul>
    </van-skeleton>
  </div> -->

  <!-- 产品体验贡献榜 start -->
  <div
    class="contribution-list block"
    v-if="
      Object.keys(activityDetail).length &&
      [4, 5, 6].includes(activityDetail.status)
    "
  >
    <van-skeleton
      title
      :row="6"
      :loading="!Object.keys(activityDetail).length"
    >
      <p class="primary-title">
        产品体验贡献榜<van-icon name="question-o" @click="handleExplainContribution" />
      </p>

      <template v-if="contributionUserList.length">
        <ul class="list clearfix">
          <li
            class="item pull-left"
            v-for="(item, index) in contributionUserList"
            :key="index"
            @click="handleGoToPersonalHomePage(item.uid)"
          >
            <span>
              <img class="avatar" :src="item.avatar_url || defaultAvatar" />
            </span>
            <p>{{ item.count }}</p>
          </li>

          <van-button
            v-if="contributionUserListHasMore"
            class="load-more"
            :loading="contributionUserListLoading"
            loading-text="加载中..."
            @click="getActivityContributionList"
          >
            <div class="flex-center">
              点击加载
              <div class="triangle-down"></div>
            </div>
          </van-button>

        </ul>
      </template>

      <template v-else>
        <p class="empty-text">榜单待公布</p>
      </template>
    </van-skeleton>
  </div>
  <!-- 产品体验贡献榜 end -->

  <template v-if="activityDetail.reg_status === 2 && currentActivityState.value === 4">
    <div class="state-submit-feedback" @click="handleClickStateButton">更新反馈</div>
  </template>

  <!--
    立即参加 start
    两个接口决定状态, 不是同步请求, 为防止闪烁误点, 故先隐藏按钮, 待最后一个接口返回后再显示
  -->
  <!-- 1. 报名成功 -->
  <!-- <template v-else-if="currentActivityState.value === 2 && isSignUp">
    <div
      v-show="isShowActivityState2Button"
      class="state-sign-up-success"
      @click="handleClickStateButton"
    >
      报名成功
    </div>
  </template> -->

  <!-- 2. 立即参加 -->
  <!-- <template v-else-if="currentActivityState.value === 2">
    <div
      v-show="isShowActivityState2Button"
      :class="currentActivityState.type"
      @click="handleClickStateButton"
    >
      {{ currentActivityState.name }}
    </div>
  </template> -->
  <!-- 立即参加 end -->

  <template v-else>
    <div :class="currentActivityState.type" @click="handleClickStateButton">
      {{ currentActivityState.name }}
    </div>
  </template>
</div>
